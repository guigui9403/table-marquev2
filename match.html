
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Feuille de Match</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: #f7f7f7;
      color: #333;
    }
    header, .actions, .team-header, .team-controls, .chrono-controls, .footer-btns {
      text-align: center;
      margin: 10px 0;
    }
    h1 {
      font-size: 1.8em;
      margin: 0.5em 0;
    }
    .teams {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
      margin: 20px 10px;
    }
    .team {
      flex: 1 1 300px;
      margin: 10px;
      padding: 10px;
      border: 3px solid #aaa;
      border-radius: 16px;
      background: #fff;
    }
    .team .player-card {
      background: #f1f1f1;
      border-radius: 12px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
      padding: 10px;
      margin: 6px 0;
      text-align: center;
    }
    .player-card .buts, .chrono2min {
      font-size: 0.85em;
      margin-top: 6px;
      color: #444;
    }
    .selected {
      outline: 3px solid #4caf50;
    }
    button {
      padding: 8px 14px;
      margin: 4px;
      border: none;
      border-radius: 8px;
      background-color: #3498db;
      color: white;
      cursor: pointer;
      font-size: 1em;
    }
    button:hover {
      background-color: #2980b9;
    }
    .team-color {
      width: 40px;
      height: 30px;
      border: 1px solid #ccc;
      vertical-align: middle;
    }
    .sanction-block {
      display: none;
      margin-top: 5px;
    }
    .history {
      background: #fff;
      margin: 10px;
      padding: 10px;
      max-height: 200px;
      overflow-y: auto;
      font-size: 0.9em;
      border-top: 1px solid #ccc;
    }
    @media screen and (max-width: 700px) {
      .teams {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <header>
    
    <div class="chrono-controls">
      <button onclick="adjustChrono(60)">+1 min</button>
      <button onclick="adjustChrono(-60)">-1 min</button>
      <button onclick="adjustChrono(10)">+10 sec</button>
      <button onclick="adjustChrono(-10)">-10 sec</button>
      <button onclick="toggleChrono()">‚ñ∂Ô∏è Play / Pause</button>
      <div><strong id="chrono">00:00</strong></div>
    </div>
    <div>
      <button onclick="startTME()">üõë TME</button>
      <span id="tmeChrono" style="font-weight:bold; margin-left:10px;"></span>
    </div>
  </header>

  <div class="team-header">
    <input id="teamAName" value="√âquipe A" onchange="updateTeamName('A')" />
    <input type="color" class="team-color" id="teamAColor" onchange="applyTeamColor('A')" />
    &nbsp;&nbsp;&nbsp;
    <input id="teamBName" value="√âquipe B" onchange="updateTeamName('B')" />
    <input type="color" class="team-color" id="teamBColor" onchange="applyTeamColor('B')" />
  </div>

  
  <div class="actions" style="text-align:center; margin-top:10px;">
    <button onclick="logAction('BUT')">‚öΩ BUT</button>
    <button onclick="logAction('2 MIN')">üïí 2 MIN</button>
    <button onclick="logAction('JAUNE')">üü® JAUNE</button>
    <button onclick="logAction('ROUGE')">üü• ROUGE</button>
    <button onclick="logAction('BLEU')">üîµ BLEU</button>
    <button onclick="undoLast()">‚Ü©Ô∏è Annuler</button>
  </div>

  <div class="teams" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 10px; padding: 10px;">

    <div class="team" id="teamA">
      <div id="playersA"></div>
    </div>
    <div class="team" id="teamB">
      <div id="playersB"></div>
    </div>
  </div>

  <div class="actions">
    <button onclick="logAction('BUT')">‚öΩ BUT</button>
    <button onclick="logAction('2 MIN')">üïí 2 MIN</button>
    <button onclick="logAction('JAUNE')">üü® JAUNE</button>
    <button onclick="logAction('ROUGE')">üü• ROUGE</button>
    <button onclick="logAction('BLEU')">üîµ BLEU</button>
    <button onclick="undoLast()">‚Ü©Ô∏è Annuler</button>
  </div>

  <div class="history" id="historique"></div>

  <div class="footer-btns">
    <a href="index.html"><button>üè† Retour √† l'accueil</button></a>
    <button onclick="exportPDF()">üìÑ Exporter en PDF</button>
  </div>

  <script>
    let mainTime = 0;
    let chronoRunning = false;
    let interval;
    let selected = null;
    let lastLine = null;
    let tmeInterval;

    function formatTime(t) {
      const m = String(Math.floor(t / 60)).padStart(2, '0');
      const s = String(t % 60).padStart(2, '0');
      return `${m}:${s}`;
    }

    function updateChrono() {
      document.getElementById("chrono").textContent = formatTime(mainTime);
    }

    function adjustChrono(sec) {
      mainTime = Math.max(0, mainTime + sec);
      updateChrono();
    }

    function toggleChrono() {
      chronoRunning = !chronoRunning;
      if (chronoRunning) {
        interval = setInterval(() => {
          mainTime++;
          updateChrono();
        }, 1000);
      } else {
        clearInterval(interval);
      }
    }

    
function startTME() {
  const team = prompt("Quel √©quipe prend le TME ? (A ou B)").toUpperCase();
  if (!["A", "B"].includes(team)) return alert("√âquipe non valide !");
  let tme = 60;
  const el = document.getElementById("tmeChrono");
  el.textContent = team + ' TME ' + formatTime(tme);
  clearInterval(tmeInterval);
  tmeInterval = setInterval(() => {
    tme--;
    el.textContent = team + ' TME ' + formatTime(tme);
    if (tme <= 0) {
      clearInterval(tmeInterval);
      el.textContent = '';
    }
  }, 1000);
}

      let tme = 60;
      const el = document.getElementById("tmeChrono");
      el.textContent = formatTime(tme);
      clearInterval(tmeInterval);
      tmeInterval = setInterval(() => {
        tme--;
        el.textContent = formatTime(tme);
        if (tme <= 0) {
          clearInterval(tmeInterval);
          el.textContent = '';
        }
      }, 1000);
    }

    function updateTeamName(team) {
      const name = document.getElementById(`team${team}Name`).value;
      document.getElementById(`team${team}`).querySelectorAll('.player-card').forEach(card => {
        card.dataset.team = name;
      });
    }

    function applyTeamColor(team) {
      const color = document.getElementById(`team${team}Color`).value;
      document.getElementById(`players${team}`).querySelectorAll('.player-card').forEach(card => {
        card.style.borderColor = color;
      });
    }

    function logAction(type) {
      if (!selected) return;
      const info = selected.dataset;
      const line = document.createElement('div');
      const time = formatTime(mainTime);
      line.textContent = `[${time}] ${type} - #${info.num} ${info.name} (${info.team})`;
      document.getElementById("historique").prepend(line);
      lastLine = line;

      
  if (type.includes("2 MIN")) {
    const tag = document.createElement('div');
    tag.textContent = "üïí 2 MIN";
    tag.className = "sanction-block";
    tag.style.display = 'block';
    selected.appendChild(tag);

    const square = document.createElement('div');
    square.style.display = 'inline-block';
    square.style.width = '14px';
    square.style.height = '14px';
    square.style.margin = '2px';
    square.style.backgroundColor = '#87CEFA';
    square.style.border = '1px solid #333';
    square.style.borderRadius = '3px';
    selected.appendChild(square);
  }

        const tag = document.createElement('div');
        tag.textContent = "üïí 2 MIN";
        tag.className = "sanction-block";
        tag.style.display = 'block';
        selected.appendChild(tag);
      }
      if (["JAUNE", "ROUGE", "BLEU"].includes(type)) {
        const tag = document.createElement('div');
        tag.textContent = type === "JAUNE" ? "üü®" : type === "ROUGE" ? "üü•" : "üîµ";
        tag.className = "sanction-block";
        tag.style.display = 'block';
        selected.appendChild(tag);
      }
      if (type === "BUT") {
        const score = selected.querySelector(".buts");
        const val = parseInt(score.dataset.count) + 1;
        score.dataset.count = val;
        score.textContent = `Buts : ${val}`;
      }
    }

    function undoLast() {
      if (lastLine) {
        lastLine.remove();
        lastLine = null;
      }
    }

    function exportPDF() {
      html2pdf().from(document.body).save("feuille_match.pdf");
    }

    function selectPlayer(el) {
      if (selected) selected.classList.remove("selected");
      selected = el;
      el.classList.add("selected");
    }

    function chargerCompo() {
      ["A", "B"].forEach(equipe => {
        ["joueur"].forEach(type => {
          const data = JSON.parse(localStorage.getItem(`compo_${equipe}_${type}`) || '[]');
          const container = document.getElementById(`players${equipe}`);
          container.innerHTML = "";
          data.forEach(p => {
            const div = document.createElement("div");
            div.className = "player-card";
            div.dataset.name = p.nom;
            div.dataset.num = p.numero;
            div.dataset.team = document.getElementById(`team${equipe}Name`).value;
            div.innerHTML = `<strong>#${p.numero}</strong><br>${p.nom}<div class="buts" data-count="0">Buts : 0</div>`;
            div.onclick = () => selectPlayer(div);
            container.appendChild(div);
          });
        });
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      chargerCompo();
      updateChrono();
    });
  </script>
</body>
</html>
